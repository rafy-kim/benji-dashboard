<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ± ë²¤ì§€ ìƒíƒœ</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ±</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }
        .container { max-width: 600px; margin: 0 auto; }
        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }
        .current-activity {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(74, 222, 128, 0.2);
            border-radius: 12px;
            border: 1px solid rgba(74, 222, 128, 0.3);
        }
        .current-activity .emoji { font-size: 1.5em; margin-right: 8px; }
        .current-activity .task { font-weight: 600; }
        .current-activity .status { opacity: 0.8; font-size: 0.9em; }
        .live-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            margin-left: 8px;
            animation: pulse-dot 1.5s infinite;
        }
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .card h2 {
            font-size: 1.2em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card h2 .emoji { font-size: 1.4em; }
        .task {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        .task:last-child { margin-bottom: 0; }
        .task-title { font-weight: 600; margin-bottom: 5px; }
        .task-status { font-size: 0.85em; opacity: 0.8; }
        .task-meta { font-size: 0.8em; opacity: 0.6; margin-top: 8px; }
        .status-active { border-left: 4px solid #4ade80; }
        .status-waiting { border-left: 4px solid #fbbf24; }
        .status-completed { border-left: 4px solid #60a5fa; }
        .footer {
            text-align: center;
            margin-top: 20px;
        }
        .update-time {
            opacity: 0.5;
            font-size: 0.85em;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .stat-number { font-size: 2.5em; font-weight: 700; }
        .stat-label { font-size: 0.85em; opacity: 0.7; margin-top: 5px; }
        .stat-active .stat-number { color: #4ade80; }
        .stat-waiting .stat-number { color: #fbbf24; }
        .stat-completed .stat-number { color: #60a5fa; }
        .pulse-icon {
            display: inline-block;
            color: #4ade80;
            animation: pulse-icon 2s infinite;
        }
        @keyframes pulse-icon {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .refresh-note {
            font-size: 0.75em;
            opacity: 0.4;
            margin-top: 10px;
        }
        .connection-status {
            font-size: 0.75em;
            opacity: 0.6;
            margin-top: 5px;
        }
        .connection-status.connected { color: #4ade80; }
        .connection-status.error { color: #f87171; }
        .fade-update {
            animation: fade-in 0.5s ease;
        }
        @keyframes fade-in {
            from { opacity: 0.5; }
            to { opacity: 1; }
        }
        .empty-state {
            text-align: center;
            opacity: 0.5;
            padding: 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ± ë²¤ì§€ ìƒíƒœ <span class="live-dot"></span></h1>
        
        <div class="current-activity" id="currentActivity">
            <span class="emoji">ğŸ”§</span>
            <span class="task">ëŒ€ì‹œë³´ë“œ êµ¬í˜„</span>
            <div class="status">ì‹¤ì‹œê°„ ì—°ë™ ì‘ì—… ì¤‘</div>
        </div>
        
        <div class="stats" id="stats">
            <div class="stat stat-active">
                <div class="stat-number" id="statActive">-</div>
                <div class="stat-label">ì§„í–‰ ì¤‘</div>
            </div>
            <div class="stat stat-waiting">
                <div class="stat-number" id="statWaiting">-</div>
                <div class="stat-label">ëŒ€ê¸° ì¤‘</div>
            </div>
            <div class="stat stat-completed">
                <div class="stat-number" id="statCompleted">-</div>
                <div class="stat-label">ì™„ë£Œ</div>
            </div>
        </div>

        <div class="card">
            <h2><span class="emoji">ğŸŸ¢</span>ì§„í–‰ ì¤‘</h2>
            <div id="activeTasks">
                <div class="empty-state">ë¡œë”© ì¤‘...</div>
            </div>
        </div>

        <div class="card">
            <h2><span class="emoji">â³</span>ëŒ€ê¸° ì¤‘</h2>
            <div id="waitingTasks">
                <div class="empty-state">ë¡œë”© ì¤‘...</div>
            </div>
        </div>

        <div class="card">
            <h2><span class="emoji">âœ…</span>ìµœê·¼ ì™„ë£Œ</h2>
            <div id="completedTasks">
                <div class="empty-state">ë¡œë”© ì¤‘...</div>
            </div>
        </div>

        <div class="footer">
            <p class="update-time" id="updateTime">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</p>
            <p class="connection-status connected" id="connectionStatus">â— ì—°ê²°ë¨</p>
            <p class="refresh-note">10ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ </p>
        </div>
    </div>

    <script>
        const STATUS_URL = 'status.json';
        const REFRESH_INTERVAL = 10000; // 10ì´ˆ
        let lastData = null;

        function formatTime(isoString) {
            const date = new Date(isoString);
            return date.toLocaleString('ko-KR', {
                month: 'numeric',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function renderTask(task, type) {
            const pulseHtml = task.pulse ? '<span class="pulse-icon">â—</span>' : '';
            return `
                <div class="task status-${type} fade-update">
                    <div class="task-title">${task.title} ${pulseHtml}</div>
                    <div class="task-status">${task.status}</div>
                    ${task.meta ? `<div class="task-meta">${task.meta}</div>` : ''}
                </div>
            `;
        }

        function renderTasks(tasks, containerId, type) {
            const container = document.getElementById(containerId);
            if (!tasks || tasks.length === 0) {
                container.innerHTML = '<div class="empty-state">ì—†ìŒ</div>';
                return;
            }
            container.innerHTML = tasks.map(t => renderTask(t, type)).join('');
        }

        function updateUI(data) {
            // í˜„ì¬ í™œë™
            const activity = data.currentActivity;
            document.getElementById('currentActivity').innerHTML = `
                <span class="emoji">${activity.emoji}</span>
                <span class="task">${activity.task}</span>
                <div class="status">${activity.status}</div>
            `;

            // í†µê³„
            document.getElementById('statActive').textContent = data.stats.active;
            document.getElementById('statWaiting').textContent = data.stats.waiting;
            document.getElementById('statCompleted').textContent = data.stats.completed;

            // ì‘ì—… ëª©ë¡
            renderTasks(data.active, 'activeTasks', 'active');
            renderTasks(data.waiting, 'waitingTasks', 'waiting');
            renderTasks(data.completed, 'completedTasks', 'completed');

            // ì—…ë°ì´íŠ¸ ì‹œê°„
            document.getElementById('updateTime').textContent = 
                `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${formatTime(data.lastUpdate)}`;
        }

        async function fetchStatus() {
            try {
                const response = await fetch(STATUS_URL + '?t=' + Date.now());
                if (!response.ok) throw new Error('Fetch failed');
                
                const data = await response.json();
                
                // ë°ì´í„° ë³€ê²½ ê°ì§€
                const dataStr = JSON.stringify(data);
                if (dataStr !== JSON.stringify(lastData)) {
                    updateUI(data);
                    lastData = data;
                }

                // ì—°ê²° ìƒíƒœ í‘œì‹œ
                const status = document.getElementById('connectionStatus');
                status.textContent = 'â— ì—°ê²°ë¨';
                status.className = 'connection-status connected';

            } catch (error) {
                console.error('Status fetch error:', error);
                const status = document.getElementById('connectionStatus');
                status.textContent = 'â— ì—°ê²° ì˜¤ë¥˜ - ì¬ì‹œë„ ì¤‘...';
                status.className = 'connection-status error';
            }
        }

        // ì´ˆê¸° ë¡œë“œ
        fetchStatus();

        // ì£¼ê¸°ì  ê°±ì‹ 
        setInterval(fetchStatus, REFRESH_INTERVAL);

        // í˜ì´ì§€ í¬ì»¤ìŠ¤ ì‹œ ì¦‰ì‹œ ê°±ì‹ 
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                fetchStatus();
            }
        });
    </script>
</body>
</html>
